#+TITLE: PROJ-005 Notes & Corkboard
#+AUTHOR: Sakya Development Team
#+STARTUP: overview

* PROJ-005 Notes & Corkboard
:PROPERTIES:
:CUSTOM_ID: PROJ-005
:GOAL: Implement notes as Markdown files with a visual corkboard arrangement for spatial organization.
:DEPENDS_INIT: PROJ-001, PROJ-003
:COMPLETION: All ITEMs complete, notes can be created/edited, corkboard displays draggable cards with persistent positions and colors.
:END:

** DONE Create Tauri notes commands
:PROPERTIES:
:CUSTOM_ID: ITEM-034-notes-commands
:AGENT: [[file:../agents/rust-architect.org::#core][rust-architect:core]]
:EFFORT: 1h
:PRIORITY: #A
:FILES: src-tauri/src/commands/notes.rs
:TEST_PLAN: compile, test-rust
:END:

*** Description
Implement Tauri commands for notes CRUD and corkboard metadata.

*** Acceptance Criteria
- [ ] =get_notes_config=: Reads =notes/notes.yaml= with positions, colors, labels for each note
- [ ] =save_notes_config=: Writes updated notes.yaml
- [ ] =get_note=: Reads a single note Markdown file
- [ ] =save_note=: Writes a note Markdown file
- [ ] =create_note=: Creates new note file and adds entry to notes.yaml
- [ ] =delete_note=: Removes note file and entry from notes.yaml

** DONE Create notes store
:PROPERTIES:
:CUSTOM_ID: ITEM-035-notes-store
:AGENT: [[file:../agents/svelte-developer.org::#core][svelte-developer:core]]
:EFFORT: 1h
:PRIORITY: #A
:FILES: src/lib/stores/notes.svelte.ts
:TEST_PLAN: compile
:END:

*** Description
Create a Svelte 5 store for notes and corkboard state management.

*** Acceptance Criteria
- [ ] NotesStore class with $state for note list, corkboard positions, colors, labels
- [ ] Methods: loadConfig, createNote, deleteNote, updateNote
- [ ] Methods: updateCardPosition, updateCardColor, updateCardLabel
- [ ] Tauri invoke calls for all backend operations
- [ ] Singleton export

** DONE Create notes binder section
:PROPERTIES:
:CUSTOM_ID: ITEM-036-notes-binder
:AGENT: [[file:../agents/svelte-developer.org::#core][svelte-developer:core]]
:EFFORT: 1h
:PRIORITY: #B
:DEPENDS: PROJ-002:ITEM-014-binder-tree
:FILES: src/lib/components/binder/NotesSection.svelte
:TEST_PLAN: compile
:END:

*** Description
Create the notes section in the binder sidebar.

*** Acceptance Criteria
- [ ] Note list in Binder with title for each note
- [ ] "+" button for creating new notes
- [ ] Click opens note in editor (via editor store)
- [ ] Visual indicator for notes with corkboard positions

** DONE Create Corkboard view
:PROPERTIES:
:CUSTOM_ID: ITEM-037-corkboard
:AGENT: [[file:../agents/svelte-developer.org::#core][svelte-developer:core]]
:EFFORT: 2h
:PRIORITY: #B
:FILES: src/lib/components/notes/Corkboard.svelte, src/lib/components/notes/NoteCard.svelte
:TEST_PLAN: compile
:END:

*** Description
Create the corkboard visual canvas with draggable note cards.

*** Acceptance Criteria
- [ ] =Corkboard.svelte=: Container with positioned cards, switchable view mode
- [ ] =NoteCard.svelte=: Draggable card showing title + excerpt (first ~50 words)
- [ ] Pointer events for free-form drag (not HTML5 DnD)
- [ ] Color strip on left edge of each card (configurable per card)
- [ ] Label badge on each card
- [ ] Cards positioned absolutely by percentage coordinates (responsive)
- [ ] Empty state with "Create your first note" prompt

** DONE Create corkboard persistence
:PROPERTIES:
:CUSTOM_ID: ITEM-038-corkboard-persistence
:AGENT: [[file:../agents/svelte-developer.org::#core][svelte-developer:core]]
:EFFORT: 1h
:PRIORITY: #B
:DEPENDS: ITEM-037-corkboard, ITEM-035-notes-store
:TEST_PLAN: compile
:END:

*** Description
Wire corkboard interactions to persistent storage via notes store and Tauri.

*** Acceptance Criteria
- [ ] On card drag end: update position in notes store, debounce save to notes.yaml via Tauri
- [ ] On card color change: save immediately
- [ ] On card label change: save immediately
- [ ] Load positions from notes.yaml on corkboard mount
- [ ] Newly created notes get default position (center of visible area)

** CHK-005-05 Corkboard Inline Editing & Card Resize
:PROPERTIES:
:CUSTOM_ID: CHK-005-05
:GOAL: Make corkboard interactive with inline editing, resizable cards, and note inspector.
:COMPLETION: Double-click expands card with textarea, cards are resizable via drag handles, NoteInspector shows metadata.
:CRITERIA: ITEM-207, ITEM-208, ITEM-209, ITEM-210, ITEM-211
:VERIFY: e2e, clippy, svelte-check
:END:

*** ITEM Add CorkboardSize to data model
:PROPERTIES:
:CUSTOM_ID: ITEM-207
:AGENT: [[file:../agents/rust-architect.org::#core][rust-architect:core]]
:EFFORT: 30m
:PRIORITY: #A
:FILES: src-tauri/src/models/notes.rs, src/lib/types/note.ts, src/lib/stores/notes.svelte.ts
:TEST_PLAN: test-rust, compile
:END:

**** Description
Add =CorkboardSize= struct/interface (width, height) to both Rust and TypeScript.
Add optional =size= field to =NoteEntry=. Add =updateCardSize()= method to notes store.

**** Acceptance Criteria
- [ ] Rust: =CorkboardSize= struct with =width: f64=, =height: f64=
- [ ] Rust: =NoteEntry.size= field with =#[serde(default)]=
- [ ] TS: =CorkboardSize= interface
- [ ] TS: =NoteEntry.size?= field
- [ ] Store: =updateCardSize(slug, size)= method
- [ ] Rust unit tests for round-trip with and without size field

*** ITEM Add resize handle to NoteCard
:PROPERTIES:
:CUSTOM_ID: ITEM-208
:AGENT: [[file:../agents/svelte-developer.org::#core][svelte-developer:core]]
:EFFORT: 2h
:PRIORITY: #A
:DEPENDS: ITEM-207
:FILES: src/lib/components/notes/NoteCard.svelte, src/lib/components/notes/Corkboard.svelte, e2e/note-resize.spec.ts
:TEST_PLAN: e2e
:END:

**** Description
Add resize handle to NoteCard (visible on hover). Drag to resize with minimum 180×120px.
Wire to Corkboard with debounced save.

**** Acceptance Criteria
- [ ] Resize handle visible on hover at bottom-right corner
- [ ] Drag resize changes card dimensions
- [ ] Resize persists via =save_notes_config= IPC
- [ ] Minimum size enforced (180×120)
- [ ] Resize does not trigger card drag
- [ ] Cards without =size= use default dimensions
- [ ] E2E tests pass

*** ITEM Add inline textarea editing to NoteCard
:PROPERTIES:
:CUSTOM_ID: ITEM-209
:AGENT: [[file:../agents/svelte-developer.org::#core][svelte-developer:core]]
:EFFORT: 3h
:PRIORITY: #A
:DEPENDS: ITEM-208
:FILES: src/lib/components/notes/NoteCard.svelte, src/lib/components/notes/Corkboard.svelte, src/lib/components/layout/EditorArea.svelte, e2e/note-inline-editing.spec.ts
:TEST_PLAN: e2e
:END:

**** Description
Double-click card to enter edit mode with textarea. Content loaded from backend.
Escape/click-outside exits and saves. Ctrl+Enter opens in full editor tab.

**** Acceptance Criteria
- [ ] Double-click shows textarea with loaded content
- [ ] Single-click selects without editing
- [ ] Typing triggers debounced =save_note= IPC
- [ ] Escape exits edit mode and saves
- [ ] Click outside exits edit mode and saves
- [ ] "Open in Editor" button opens tab
- [ ] Ctrl+Enter opens note in tab
- [ ] EditorArea effect guarded for corkboard mode
- [ ] E2E tests pass

*** ITEM Create NoteInspector component
:PROPERTIES:
:CUSTOM_ID: ITEM-210
:AGENT: [[file:../agents/svelte-developer.org::#core][svelte-developer:core]]
:EFFORT: 1h
:PRIORITY: #B
:DEPENDS: ITEM-209
:FILES: src/lib/components/inspector/NoteInspector.svelte, src/lib/components/layout/AppShell.svelte
:TEST_PLAN: e2e
:END:

**** Description
Simple inspector showing note metadata (color, label, body preview) when a note is selected.
Wire into AppShell inspector pane.

**** Acceptance Criteria
- [ ] NoteInspector shows color, label, body preview
- [ ] "Open in Editor" button
- [ ] Visible when note tab active or corkboard note selected
- [ ] Replaces "No inspector available" placeholder for notes

*** ITEM Visual polish and comprehensive testing
:PROPERTIES:
:CUSTOM_ID: ITEM-211
:AGENT: [[file:../agents/testing-engineer.org::#core][testing-engineer:core]]
:EFFORT: 1h
:PRIORITY: #B
:DEPENDS: ITEM-210
:FILES: e2e/note-resize.spec.ts, e2e/note-inline-editing.spec.ts
:TEST_PLAN: e2e, clippy, svelte-check
:END:

**** Description
CSS transitions, textarea styling, full E2E suite run, all lints clean.

**** Acceptance Criteria
- [ ] CSS transitions for card expand/collapse
- [ ] Textarea monospace styling with proper padding
- [ ] Full E2E suite passes (no regressions)
- [ ] =cargo clippy= clean
- [ ] =cargo fmt --check= clean
- [ ] =bunx svelte-check= clean
